# Workflow de prueba - Crear archivo con fecha y hora
name: Test - Crear archivo

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:  # Solo manual para pruebas
  
jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Crear archivo con fecha y hora
        uses: appleboy/ssh-action@v1.2.0
        env:
          SSH_VM_PASS: ${{ secrets.SSH_PASSWORD }}
        with:
          host: ${{ secrets.SSH_HOST }}
          port: ${{ secrets.SSH_PORT }}
          username: ${{ secrets.SSH_USER }}
          password: ${{ secrets.SSH_PASSWORD }}
          envs: SSH_VM_PASS
          script: |
            echo "=== Servidor principal ==="
            echo "Usuario: $(whoami)"
            echo "Conectando a VM 192.168.1.21..."
            /usr/bin/sshpass -p "$SSH_VM_PASS" ssh -o StrictHostKeyChecking=no merx@192.168.1.21 << 'EOF'
              echo "=== VM Interna ==="
              echo "Usuario: $(whoami)"
              cd /home/aziende/web/dev.aziende.us/public_html
              echo "Directorio: $(pwd)"
              FECHA=$(date '+%Y-%m-%d_%H-%M-%S')
              touch test_$FECHA.txt
              echo "Archivo creado en: $(date)" > test_$FECHA.txt
              echo "Archivo creado: test_$FECHA.txt"
              ls -la
            EOF